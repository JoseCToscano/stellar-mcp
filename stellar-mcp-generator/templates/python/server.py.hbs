"""
{{server_name}} MCP Server
Generated from contract: {{contract_id}}
Network: {{network_name}}

MCP server for interacting with the {{contract_name}} Soroban contract.
"""

import os
import asyncio
from mcp.server.fastmcp import FastMCP, Context
from typing import Optional, Any, Dict
from dotenv import load_dotenv

# Load environment variables
load_dotenv()

# Import contract client
from src.contract_client import ContractClient, ContractConfig

# Initialize MCP server
mcp = FastMCP("{{server_name}}")

# Initialize contract configuration from environment
config = ContractConfig(
    contract_id=os.getenv("CONTRACT_ID", "{{contract_id}}"),
    rpc_url=os.getenv("RPC_URL", "{{rpc_url}}"),
    network_passphrase=os.getenv("NETWORK_PASSPHRASE", "{{network_passphrase}}")
)

# Initialize contract client
client = ContractClient(config)

{{#each functions}}
@mcp.tool()
async def {{name_snake}}(
    {{#each inputs}}
    {{name_snake}}: {{py_type}},
    {{/each}}
    ctx: Optional[Context] = None
) -> Dict[str, Any]:
    """
    {{doc}}
    {{#if inputs}}

    Parameters:
    {{#each inputs}}
    - {{name_snake}} ({{py_type}}): {{#if doc}}{{doc}}{{else}}Contract parameter{{/if}}
    {{/each}}
    {{/if}}

    Returns:
        Dict containing 'xdr' (transaction XDR) and optionally 'simulationResult'
    """
    if ctx:
        await ctx.info(f"Calling {{name}} with parameters...")

    try:
        result = await client.{{name_snake}}(
            {{#each inputs}}
            {{name_snake}}={{name_snake}},
            {{/each}}
        )

        if ctx:
            await ctx.info(f"Successfully called {{name}}")

        return result
    except Exception as e:
        if ctx:
            await ctx.error(f"Error calling {{name}}: {str(e)}")
        raise

{{/each}}

if __name__ == "__main__":
    # Run the MCP server using stdio transport (for Claude Desktop)
    mcp.run()
